* claudemacs-repl
Enhanced client utilities for claudemacs - extending AI pair programming capabilities in Emacs.

[[<https://github.com/phasetr/claudemacs-repl/workflows/CI/badge.svg]]>
<[[https://img.shields.io/badge/License-MIT-yellow.svg]]>

** Design Philosophy
This package provides minimal documentation and maximum customization freedom for advanced Emacs users who:
- Have a strong will to use Claude Code outside of officially supported VSCode
- Prefer to configure their own efficient workflows
- Define their own transient menus and keybinding preferences
- Or are familiar with =send-region= patterns (like F# REPL =C-c C-r=)

Welcome to the freedom of Emacs world - we provide the tools, you create the experience.

*** Author's Personal Approach
"I cannot remember keybindings unless I use them daily, and transient menus are even more hopeless. From the early prototype stage of this package, I have not set any keybindings and only remember =send-region= and =send-rest-of-buffer=, executing them via =M-x= with fuzzy search. When using Claude Code, I'm focused and only use these functions, so they always appear at the top of the completion list and can be executed immediately."

This personal workflow is the foundation for our function-name-first design philosophy. Common keybindings like =C-c C-r= for send-region are widely used, but we leave all efficiency optimizations to your expertise.

*** Core Design Principles

**** File-based vs Buffer-based
- Claude Code's limitation: difficult to preserve personal comments and context
- Avoid building complex history features - use files for persistence instead
- Files allow complete preservation of past comments and thought processes
- Add content chronologically at the bottom, use =send-region= or =send-rest-of-buffer= to send specific parts
- When inspiration strikes after Claude Code execution, write it down in the file - no more forgotten ideas

**** Workflow Flexibility
- Always use =send-region=? Write new comments below the current content
- Always use =send-rest-of-buffer=? Write notes slightly above the cursor position
- File persistence means your workflow adapts to your thinking patterns

**** Filename-Buffer Mapping
- File-local variables and parsing file contents are tedious
- Use filename encoding for simple, unambiguous (2025-8-temporal) claudemacs buffer correspondence
- Ugly but functional: filename directly encodes the target directory

**** Org-mode Choice
- This is Emacs - use org-mode, not markdown
- Leverage Emacs's native structured document capabilities

** Features
- üöÄ *Enhanced Text Sending*: Send regions, buffers, or cursor-to-end text to claudemacs
- üìù *Persistent Input Files*: Org-mode enabled files with multi-language template support (Being Japanese, I want Japanese templates to be easily usable)
- üîç *Directory-Based Targeting*: Automatically match files to appropriate claudemacs buffers (depends on claudemacs buffer naming convention)
- üìÅ *Template Customization*: External template files for maximum flexibility

** Installation

*** Using straight.el (Recommended)
#+begin_src elisp
(straight-use-package
  '(claudemacs-repl :host github :repo "phasetr/claudemacs-repl"))
#+end_src

*** Manual Installation
1. Download =claudemacs-repl.el=
2. Add to your Emacs configuration:

#+begin_src elisp
;; Add to load path
(add-to-list 'load-path "/path/to/claudemacs-repl")

;; Load the package
(require 'claudemacs-repl)
#+end_src

*** Prerequisites
- Emacs 28.1 or later
- [[https://github.com/cpoile/claudemacs][claudemacs]] installed and configured
- [[https://github.com/anthropics/claude-code][Claude Code CLI]] setup

** Usage

*** Quick Start
1. Start claudemacs in your project directory
2. Run =M-x claudemacs-repl-open-project-input-file=
3. Use the template functions shown in the generated file

*** Essential Functions
- =claudemacs-repl-open-project-input-file= - Open or create project input file
- =claudemacs-repl-send-region= - Send selected text to claudemacs
- =claudemacs-repl-send-rest-of-buffer= - Send rest of buffer from cursor position
- =claudemacs-repl-send-buffer= - Send entire buffer
- =claudemacs-repl-status= - Show connection status and diagnostics

** Configuration
*** Template Configuration
#+begin_src elisp
;; Use default template (uses templates/default.org from package)
(setq claudemacs-repl-template-file nil)

;; Use custom template file
(setq claudemacs-repl-template-file "~/my-claude-template.org")

;; Use template from another package or system location
(setq claudemacs-repl-template-file "/usr/local/share/emacs/claude-templates/my-template.org")

;; Use project-specific template
(setq claudemacs-repl-template-file (expand-file-name "claude-template.org" user-emacs-directory))
#+end_src

*** Template Customization
Use =M-x claudemacs-repl-output-template= to output the default template to a new buffer for customization.

** Troubleshooting
If you see "‚ùå Cannot send - no matching claudemacs buffer found for this directory":

1. Ensure claudemacs is running: =M-x claudemacs-transient-menu=
2. Check if Claude Code CLI is properly configured
3. Use =M-x claudemacs-repl-status= for diagnostic information

** Development

*** Running Tests
#+begin_src bash
make check
#+end_src

** Contributing
This package prioritizes maintainability over feature requests. For template translations or custom workflows, prefer using the =custom= template mechanism rather than contributing to the core package.

Note: Due to leukemia recurrence in June 2024, the maintainer is concerned about potential health deterioration and may have limited capacity for reviewing contributions.

** License
This project is licensed under the MIT License - see the [[file:LICENSE][LICENSE]] file for details.

** Support
- üêõ [[https://github.com/phasetr/claudemacs-repl/issues][Issue Tracker]]
- üí¨ [[https://github.com/phasetr/claudemacs-repl/discussions][Discussions]]
